geom_histogram(
data = df_hist,
aes(x = age),
breaks = seq(0, max(df_hist$age), by = 5),
fill = "gray80",
color = "gray60"
) +
geom_line(
data = df_prev,
aes(x = age_mid, y = seroprev * hist_max),
color = "#b2182b",
linewidth = 1.2
) +
scale_y_continuous(
name = "Count (Histogram)",
sec.axis = sec_axis(
trans = ~ . / hist_max,
labels = percent_format(accuracy = 1),
name = "Seroprevalence (%)"
)
) +
labs(
title = paste("Age Distribution + Seroprevalence Curve:", antigen_name),
x = "Age (years)"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 15),
axis.title.y.right = element_text(color = "#b2182b")
)
}
antigens <- unique(sero_long$antigen)
plots <- map(antigens, plot_hist_seroprev)
names(plots) <- antigens
plots$PfCSP
plots$PfMSP1
plots$PfMSP1
plots$PmMSP119
plots$PoMSP119
library(readxl)
library(tidyverse)
library(utils)
library(dplyr)
library(stringr)
library(EnvStats)
glyphosate <- read_excel("~/Desktop/ILE/Glyphosate project/IKIDS_Glyphosate.xlsx")
oxstress <- read_excel("~/Desktop/ILE/Glyphosate project/IKIDS_oxidative_stress.xlsx")
demographics <- read.csv("~/Desktop/ILE/Glyphosate project/ECHO.CA.IL_Combined_Data.csv")
demographics <- demographics |> mutate(ppt_id=str_remove(ppt_id, "^3")) |> filter(study == "IKIDS")
demographics <- demographics |>
select(
ppt_id,
mat_age,
parity,
ppbmi,
bmi_cat,
marital,
mat_race_eth,
mat_educ,
employ,
sex,
best_edd
) |>
mutate(bmi_cat = if_else(bmi_cat == 1, 2, bmi_cat),
marital = if_else(marital == 3, 2, marital),
mat_race_eth = case_when(mat_race_eth %in% c(3, 4, 5) ~ 2,
TRUE ~ mat_race_eth
))
merged <- demographics |>
mutate(ppt_id=as.character(ppt_id)) |>
inner_join(oxstress |>
mutate(ppt_id=as.character(ppt_id)), by="ppt_id") |>
inner_join(glyphosate |>
rename(ppt_id = ID) |>
mutate(ppt_id=as.character(ppt_id)), by="ppt_id")
merged$log.iso_sg_avg <- log(merged$iso_sg_avg)
merged$log.isom_sg_avg <- log(merged$isom_sg_avg)
merged$log.isom_new_sg_avg <- log(merged$isom_new_sg_avg)
merged$log.pgf_sg_avg <- log(merged$pgf_sg_avg)
merged$log.iso_chem_sg_avg <- log(merged$iso_chem_sg_av)
merged$log.iso_enz_sg_avg <- log(merged$iso_enz_sg_avg)
merged$glyph.iqr<-log(merged$Glyphosate_PA_SG)/(iqr(log(merged$Glyphosate_PA_SG),na.rm=T))
merged$ampa_constant <- merged$AMPA_PA_SG + 0.0001
merged$ampa.iqr<-log(merged$ampa_constant)/(iqr(log(merged$ampa_constant),na.rm=T))
#Create tertiles for Glyphosate
merged$glyph_tertile <- cut(
merged$Glyphosate_PA_SG,
breaks = quantile(merged$Glyphosate_PA_SG, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE),
include.lowest = TRUE,
labels = c(1, 2, 3)
)
merged$glyph_tertile_num <- as.numeric(as.character(merged$glyph_tertile))
# Create tertiles for AMPA
merged$ampa_tertile <- cut(
merged$AMPA_PA_SG,
breaks = quantile(merged$AMPA_PA_SG, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE),
include.lowest = TRUE,
labels = c(1, 2, 3)
)
merged$ampa_tertile_num <- as.numeric(as.character(merged$ampa_tertile))
#--- Adjusted SCALED Glyphosate models ---
glyph_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ glyph.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
library(broom)
library(dplyr)
library(ggplot2)
# Define oxidative stress outcomes
outcomes <- c("log.iso_sg_avg", "log.isom_sg_avg", "log.isom_new_sg_avg",
"log.pgf_sg_avg", "log.iso_chem_sg_avg", "log.iso_enz_sg_avg")
#--- Adjusted SCALED Glyphosate models ---
glyph_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ glyph.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
glyph_res_adj <- bind_rows(lapply(seq_along(glyph_models_adj), \(i)
tidy(glyph_models_adj[[i]], conf.int = TRUE) |> mutate(outcome = outcomes[i])
)) |>
filter(term == "glyph.iqr") |>
mutate(exposure = "Glyphosate")
# --- Adjusted AMPA models ---
ampa_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ ampa.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
ampa_res_adj <- bind_rows(lapply(seq_along(ampa_models_adj), \(i)
tidy(ampa_models_adj[[i]], conf.int = TRUE) |> mutate(outcome = outcomes[i])
)) |>
filter(term == "ampa.iqr") |>
mutate(exposure = "AMPA")
# Combine both exposures
all_res_adj <- bind_rows(glyph_res_adj, ampa_res_adj)
all_res_adj <- all_res_adj %>%
mutate(
outcome = recode(outcome,
"log.iso_sg_avg" = "IsoP-SG",
"log.isom_sg_avg" = "IsoM-SG",
"log.isom_new_sg_avg" = "IsoMnew-SG",
"log.pgf_sg_avg" = "PGF-SG",
"log.iso_chem_sg_avg" = "IsoChem-SG",
"log.iso_enz_sg_avg" = "IsoEnz-SG"
)
)
all_res_adj$exposure <- factor(all_res_adj$exposure, levels = c("Glyphosate", "AMPA"))
ggplot(all_res_adj, aes(x = estimate, y = outcome, color = exposure)) +
geom_point(size = 3) +
geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
facet_wrap(~ exposure, nrow = 1, scales = "free_x") +
labs(
x = "Beta Estimate (95% CI)",
y = "Oxidative Stress Biomarker",
title = "Adjusted Associations of Glyphosate and AMPA with Oxidative Stress Biomarkers",
caption = "Models adjusted for maternal age, pre-pregnancy BMI, whole grain intake (AHEI), and education level"
) +
theme_bw(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.y = element_line(color = "gray90"),
strip.text = element_text(size = 13, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
#--- Adjusted SCALED Glyphosate models ---
glyph_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ glyph.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
glyph_res_adj <- bind_rows(lapply(seq_along(glyph_models_adj), \(i)
tidy(glyph_models_adj[[i]], conf.int = TRUE) |> mutate(outcome = outcomes[i])
)) |>
filter(term == "glyph.iqr") |>
mutate(exposure = "Glyphosate")
# --- Adjusted AMPA models ---
ampa_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ ampa.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
ampa_res_adj <- bind_rows(lapply(seq_along(ampa_models_adj), \(i)
tidy(ampa_models_adj[[i]], conf.int = TRUE) |> mutate(outcome = outcomes[i])
)) |>
filter(term == "ampa.iqr") |>
mutate(exposure = "AMPA")
# Combine both exposures
all_res_adj <- bind_rows(glyph_res_adj, ampa_res_adj)
all_res_adj <- all_res_adj %>%
mutate(
outcome = recode(outcome,
"log.iso_sg_avg" = "8-iso-PGF2α",
"log.isom_sg_avg" = "2,3-dinor-5,6-dihydro-8-iso-PGF2α",
"log.isom_new_sg_avg" = "2,3-dinor-8-iso-PGF2α",
"log.pgf_sg_avg" = "PGF2α",
"log.iso_chem_sg_avg" = "8-iso-PGF2α, chemical fraction",
"log.iso_enz_sg_avg" = "8-iso-PGF2α, enzymatic fraction"
)
)
all_res_adj$exposure <- factor(all_res_adj$exposure, levels = c("Glyphosate", "AMPA"))
ggplot(all_res_adj, aes(x = estimate, y = outcome, color = exposure)) +
geom_point(size = 3) +
geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
facet_wrap(~ exposure, nrow = 1, scales = "free_x") +
labs(
x = "Beta Estimate (95% CI)",
y = "Oxidative Stress Biomarker",
title = "Adjusted Associations of Glyphosate and AMPA with Oxidative Stress Biomarkers",
caption = "Models adjusted for maternal age, pre-pregnancy BMI, whole grain intake (AHEI), and education level"
) +
theme_bw(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.y = element_line(color = "gray90"),
strip.text = element_text(size = 13, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
#--- Adjusted SCALED Glyphosate models ---
glyph_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ glyph.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
glyph_res_adj <- bind_rows(lapply(seq_along(glyph_models_adj), \(i)
tidy(glyph_models_adj[[i]], conf.int = TRUE) |> mutate(outcome = outcomes[i])
)) |>
filter(term == "glyph.iqr") |>
mutate(exposure = "Glyphosate")
# --- Adjusted AMPA models ---
ampa_models_adj <- lapply(outcomes, \(y)
lm(as.formula(paste(y, "~ ampa.iqr + mat_age + ppbmi + AHEI_WGRAINS_PA + as.factor(mat_educ)")),
data = merged)
)
ampa_res_adj <- bind_rows(lapply(seq_along(ampa_models_adj), \(i)
tidy(ampa_models_adj[[i]], conf.int = TRUE) |> mutate(outcome = outcomes[i])
)) |>
filter(term == "ampa.iqr") |>
mutate(exposure = "AMPA")
# Combine both exposures
all_res_adj <- bind_rows(glyph_res_adj, ampa_res_adj)
all_res_adj <- all_res_adj %>%
mutate(
outcome = recode(outcome,
"log.iso_sg_avg" = "8-iso-PGF2α",
"log.isom_sg_avg" = "2,3-dinor-5,6-dihydro-8-iso-PGF2α",
"log.isom_new_sg_avg" = "2,3-dinor-8-iso-PGF2α",
"log.pgf_sg_avg" = "PGF2α",
"log.iso_chem_sg_avg" = "8-iso-PGF2α, chemical fraction",
"log.iso_enz_sg_avg" = "8-iso-PGF2α, enzymatic fraction"
)
)
all_res_adj$exposure <- factor(all_res_adj$exposure, levels = c("Glyphosate", "AMPA"))
ggplot(all_res_adj, aes(x = estimate, y = outcome, color = exposure)) +
geom_point(size = 3) +
geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
facet_wrap(~ exposure, nrow = 1, scales = "free_x") +
labs(
x = "Beta Estimate (95% CI)",
y = "Oxidative Stress Biomarker",
title = "Adjusted Associations of Glyphosate and AMPA with Oxidative Stress Biomarkers",
caption = "Models adjusted for maternal age, pre-pregnancy BMI, AHEI, and education level"
) +
theme_bw(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.y = element_line(color = "gray90"),
strip.text = element_text(size = 13, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
setwd("/Users/julia/Desktop/renv")
#log transform outcomes
data <- data |>
mutate(
log.iso_sg_avg      = log(iso_sg_avg.sim + 1e-6),
log.isom_sg_avg     = log(isom_sg_avg.sim + 1e-6),
log.isom_new_sg_avg = log(isom_new_sg_avg.sim + 1e-6),
log.pgf_sg_avg      = log(pgf_sg_avg.sim + 1e-6),
log.iso_chem_sg_avg = log(iso_chem_sg_avg.sim + 1e-6),
log.iso_enz_sg_avg  = log(iso_enz_sg_avg.sim + 1e-6)
)
here::i_am("code/01_make_table.R"
)
library(readxl)
library(tidyverse)
library(utils)
library(dplyr)
library(stringr)
library(dplyr)
library(knitr)
library(kableExtra)
library(openxlsx)
library(gridExtra)
library(ggplot2)
library(here)
data <- read_excel(here("data/simulated_data.xlsx"))
setwd("/Users/julia/DATA 550 Glyph")
here::i_am("code/01_make_table.R"
)
library(readxl)
library(tidyverse)
library(utils)
library(dplyr)
library(stringr)
library(dplyr)
library(knitr)
library(kableExtra)
library(openxlsx)
library(gridExtra)
library(ggplot2)
library(here)
data <- read_excel(here("data/simulated_data.xlsx"))
#log transform outcomes
data <- data |>
mutate(
log.iso_sg_avg      = log(iso_sg_avg.sim + 1e-6),
log.isom_sg_avg     = log(isom_sg_avg.sim + 1e-6),
log.isom_new_sg_avg = log(isom_new_sg_avg.sim + 1e-6),
log.pgf_sg_avg      = log(pgf_sg_avg.sim + 1e-6),
log.iso_chem_sg_avg = log(iso_chem_sg_avg.sim + 1e-6),
log.iso_enz_sg_avg  = log(iso_enz_sg_avg.sim + 1e-6)
)
#scaling glyphosate by iqr
data$glyph_constant <- data$Glyphosate_PA_SG.sim + 0.0001
data$glyph.iqr<-log(data$glyph_constant)/(IQR(log(data$glyph_constant),na.rm=T))
#unadjusted linear regression ox stress & glyphosate scaled by iqr
outcome1 <- lm(data$log.iso_sg_avg ~ data$glyph.iqr)
outcome2 <- lm(data$log.isom_sg_avg ~ data$glyph.iqr)
outcome3 <- lm(data$log.isom_new_sg_avg ~ data$glyph.iqr)
outcome4 <- lm(data$log.pgf_sg_avg ~ data$glyph.iqr)
outcome5 <- lm(data$log.iso_chem_sg_avg ~ data$glyph.iqr)
outcome6 <- lm(data$log.iso_enz_sg_avg ~ data$glyph.iqr)
#mapping variable names to readable labels
outcome_labels <- tibble(
Outcome = c("iso_sg", "isom_sg", "isom_new_sg", "pgf_sg", "iso_chem_sg", "iso_enz_sg"),
Label = c(
"Isoprostanes",
"Isoprostane isomers",
"New isomers",
"Prostaglandin F",
"Chem isoprostanes",
"Enz isoprostanes"
)
)
models <- list(
iso_sg      = outcome1,
isom_sg     = outcome2,
isom_new_sg = outcome3,
pgf_sg      = outcome4,
iso_chem_sg = outcome5,
iso_enz_sg  = outcome6
)
# extracting coef + CI for glyph.iqr from each
results <- lapply(names(models), function(name) {
coefs <- coef(models[[name]])
ci <- confint(models[[name]])
tibble(
Outcome = name,
Beta = coefs["data$glyph.iqr"],
`95% CI` = sprintf("(%.2f, %.2f)", ci["data$glyph.iqr", 1], ci["data$glyph.iqr", 2])
)
}) %>% bind_rows()
results <- results %>%
left_join(outcome_labels, by = "Outcome") %>%
select(Label, Beta, `95% CI`) %>%
rename(Outcome = Label)
knitr::kable(results, digits = 2,
caption = "Glyphosate and oxidative stress biomarker outcomes") |>
kable_styling(full_width = FALSE, font_size = 13, bootstrap_options = c("striped", "hover", "condensed"))
results_df <- results
rownames(results_df) <- NULL
results_df <- results
rownames(results_df) <- NULL
table_plot <- gridExtra::tableGrob(
results_df,
rows = NULL,
theme = gridExtra::ttheme_default(
core = list(fg_params = list(cex = 1.4)),
colhead = list(fg_params = list(cex = 1.5, fontface = "bold"))
)
)
table_plot$widths <- unit(rep(1, ncol(results_df)), "null")
table_plot$heights <- unit(rep(1, nrow(results_df) + 1), "null")
png(
filename = here("outputs", "table_glyphosate_oxstress.png"),
width = 900,          # width in pixels
height = 650,         # height in pixels
res = 120             # resolution
)
grid::grid.newpage()
grid::grid.draw(table_plot)
dev.off()
here::i_am("code/01_make_table.R"
)
library(readxl)
library(tidyverse)
library(utils)
library(dplyr)
library(stringr)
library(dplyr)
library(knitr)
library(kableExtra)
library(openxlsx)
library(gridExtra)
library(ggplot2)
library(here)
data <- read_excel(here("data/simulated_data.xlsx"))
#log transform outcomes
data <- data |>
mutate(
log.iso_sg_avg      = log(iso_sg_avg.sim + 1e-6),
log.isom_sg_avg     = log(isom_sg_avg.sim + 1e-6),
log.isom_new_sg_avg = log(isom_new_sg_avg.sim + 1e-6),
log.pgf_sg_avg      = log(pgf_sg_avg.sim + 1e-6),
log.iso_chem_sg_avg = log(iso_chem_sg_avg.sim + 1e-6),
log.iso_enz_sg_avg  = log(iso_enz_sg_avg.sim + 1e-6)
)
#scaling glyphosate by iqr
data$glyph_constant <- data$Glyphosate_PA_SG.sim + 0.0001
data$glyph.iqr<-log(data$glyph_constant)/(IQR(log(data$glyph_constant),na.rm=T))
#unadjusted linear regression ox stress & glyphosate scaled by iqr
outcome1 <- lm(data$log.iso_sg_avg ~ data$glyph.iqr)
outcome2 <- lm(data$log.isom_sg_avg ~ data$glyph.iqr)
outcome3 <- lm(data$log.isom_new_sg_avg ~ data$glyph.iqr)
outcome4 <- lm(data$log.pgf_sg_avg ~ data$glyph.iqr)
outcome5 <- lm(data$log.iso_chem_sg_avg ~ data$glyph.iqr)
outcome6 <- lm(data$log.iso_enz_sg_avg ~ data$glyph.iqr)
#mapping variable names to readable labels
outcome_labels <- tibble(
Outcome = c("iso_sg", "isom_sg", "isom_new_sg", "pgf_sg", "iso_chem_sg", "iso_enz_sg"),
Label = c(
"Isoprostanes",
"Isoprostane isomers",
"New isomers",
"Prostaglandin F",
"Chem isoprostanes",
"Enz isoprostanes"
)
)
models <- list(
iso_sg      = outcome1,
isom_sg     = outcome2,
isom_new_sg = outcome3,
pgf_sg      = outcome4,
iso_chem_sg = outcome5,
iso_enz_sg  = outcome6
)
# extracting coef + CI for glyph.iqr from each
results <- lapply(names(models), function(name) {
coefs <- coef(models[[name]])
ci <- confint(models[[name]])
tibble(
Outcome = name,
Beta = coefs["data$glyph.iqr"],
`95% CI` = sprintf("(%.2f, %.2f)", ci["data$glyph.iqr", 1], ci["data$glyph.iqr", 2])
)
}) %>% bind_rows()
results <- results %>%
left_join(outcome_labels, by = "Outcome") %>%
select(Label, Beta, `95% CI`) %>%
rename(Outcome = Label)
knitr::kable(results, digits = 2,
caption = "Glyphosate and oxidative stress biomarker outcomes") |>
kable_styling(full_width = FALSE, font_size = 13, bootstrap_options = c("striped", "hover", "condensed"))
results_df <- results
rownames(results_df) <- NULL
results_df <- results
rownames(results_df) <- NULL
table_plot <- gridExtra::tableGrob(
results_df,
rows = NULL,
theme = gridExtra::ttheme_default(
core = list(fg_params = list(cex = 1.4)),
colhead = list(fg_params = list(cex = 1.5, fontface = "bold"))
)
)
table_plot$widths <- unit(rep(1, ncol(results_df)), "null")
table_plot$heights <- unit(rep(1, nrow(results_df) + 1), "null")
png(
filename = here("outputs", "table_glyphosate_oxstress.png"),
width = 900,          # width in pixels
height = 650,         # height in pixels
res = 120             # resolution
)
grid::grid.newpage()
grid::grid.draw(table_plot)
dev.off()
here::i_am("code/02_make_figure.R"
)
library(readxl)
library(here)
library(mgcv)
library(openxlsx)
library(tidyverse)
data <- read_excel(here("data/simulated_data.xlsx"))
data <- data |>
mutate(
log.iso_sg_avg = log(iso_sg_avg.sim + 1e-6)
)
gam1 <- gam(log.iso_sg_avg ~ s(log_Glyphosate_PA_SG.sim), data = data)
png(
filename = here("outputs", "figure_glyphosate_iso.png"),
width = 900,
height = 650,
res = 120
)
plot(
gam1,
shade = TRUE,
seWithMean = TRUE,
main = "Relationship between Glyphosate and Isoprotanes",
xlab = "Glyphosate (log-transformed)",
ylab = "Smooth function of Glyphosate"
)
dev.off()
